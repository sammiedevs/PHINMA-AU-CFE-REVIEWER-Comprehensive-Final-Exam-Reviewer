<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>

    <link rel="stylesheet" href="style.css">
	
    <title>Teacher Dashboard</title>
</head>
<style>
    body{
        background: #eee;
    }
    a{
        text-decoration: none !important;
    }
    .cards .card img {
            width: 50px !important;
            height: 50px !important;
            object-fit: cover; /* Ensures images donâ€™t get stretched */
        }
        .data-container {
            display: flex;
            justify-content: space-between; /* Places sections side by side */
            gap: 20px; /* Adds space between sections */
        }

        .data {
            flex: 1; /* Makes both sections take equal width */
            min-width: 45%; /* Prevents them from becoming too narrow */
        }

        .data {
            background: #fff;
            padding: 40px;
            border-radius: 30px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            margin-top: 30px;
        }
        .page {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #F59D37;
            margin-bottom: 10px;
            padding-bottom: 10px;
        }
        .page h1 {
            font-size: 35px;
            color: #161041;
            margin: 0;
            width: 100%;
        }
        .actions {
        display: flex;
        gap: 10px;
    }
    
    .edit-btn, .delete-btn, .download-btn {
        background: none;
        border: none;
        cursor: pointer;
        color: #161041;
        font-size: 18px;
    }
    
    .delete-btn {
        color: #AA4A44;
    }
    
    .edit-btn {
        color: #F59D37;
		margin-right: -30px;
    }

	.subject-list {
        width: 100%; /* Make the list take up full width */
        display: flex;
        flex-direction: column; /* Stack items vertically */
        gap: 5px; /* Space between items */
        padding: 10px;
    }

    .subject-button {
        margin-top: 5px;
        background: #f0f0f0;
        padding: 15px 20px;
        border: 1px solid #ddd;
        border-radius: 5px;
        cursor: pointer;
        text-align: left; /* Align text to the left */
        transition: background 0.3s, transform 0.3s, box-shadow 0.3s;
        display: flex;
        justify-content: space-between; /* Space between subject name and actions */
        align-items: center;
        width: 100%; /* Make each button take up full width */
    }

    .subject-button:hover {
        background: #161041;
        transform: translateY(-2px); /* Slight lift on hover */
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1); /* Add shadow on hover */
    }
    .subject-button:hover .subject-name {
        color: white; /* Change text color to white on hover */
    }

    .subject-button .subject-name {
        font-size: 18px;
        font-weight: 500;
        color: #161041; /* Dark blue for subject name */
        display: flex;
        align-items: center;
        gap: 10px; /* Space between icon and text */
    }

    .subject-button .subject-name i {
        font-size: 20px; /* Icon size */
        color: #F59D37; /* Icon color */
    }

    .add-subject-button {
        position: relative;
        width: 110px;
        height: 40px;
        cursor: pointer;
        display: flex;
        align-items: center;
        border: 1px solid #34974d;
        background-color: #3aa856;
        overflow: hidden; /* Ensure the icon doesn't overflow */
        padding-left: 10px; /* Add left padding to align text */
        padding-right: 10px;
    }

    .add-subject-button, .button__icon, .button__text {
        transition: all 0.3s;
    }

    .add-subject-button .button__text {
        color: #fff;
        font-weight: 600;
        text-align: left; /* Align text to the left */
        flex-grow: 1; /* Allow text to take up remaining space */
    }

    .add-subject-button .button__icon {
        position: absolute;
        right: 0; /* Position icon on the right */
        height: 100%;
        width: 39px;
        background-color: #34974d;
        display: flex;
        align-items: center;
        justify-content: center;
        transform: translateX(calc(100% - 30px)); /* Partially show the icon */
    }

    .add-subject-button .svg {
        width: 30px;
        stroke: #fff;
        padding-right: 10px;
    }

    .add-subject-button:hover {
        background: #34974d;
    }

    .add-subject-button:hover .button__text {
        color: transparent; /* Hide text on hover */
    }

    .add-subject-button:hover .button__icon {
        width: 100%; /* Expand icon to full width on hover */
        transform: translateX(0); /* Move icon to the left */
    }

    .add-subject-button:active .button__icon {
        background-color: #2e8644; /* Change icon background on active */
    }

    .add-subject-button:active {
        border: 1px solid #2e8644; /* Change border color on active */
    }

</style>
<body>
    <!-- Sidebar -->
    <section id="sidebar">
        <a href="teacher_dashboard.html" class="brand">
            <img src="img/logo.jpg">
        </a>
        <ul class="side-menu top">
            <li class="active">
                <a href="teacher_dashboard.html">
                    <i class="fas fa-home"></i>
                    <span class="text">Dashboard</span>
                </a>
            </li>
            <li>
                <a href="teacher_file.html">
                    <i class="fas fa-file-alt"></i>
                    <span class="text">Learning Files</span>
                </a>
            </li>
            
        </ul>
        <ul class="side-menu bot" style="margin-top: 580px;">
            <li>
                <a href="teacher_login.html">
                    <i style="color: #AA4A44;" class="fas fa-sign-out-alt"></i>
                    <span style="color: #AA4A44;" class="text">Logout</span>
                </a>
            </li>
        </ul>
    </section>

    <!-- Content -->
    <section id="content">
        <nav>
            <i class='bx bx-menu' id="sidebar-toggle"></i>
            <a href="#" class="nav-link">Categories</a>
            <form action="#">
                <div class="form-input">
                    <input type="search" placeholder="Search...">
                    <button type="submit" class="search-btn"><i class='bx bx-search-alt-2'></i></button>
                </div>
            </form>
            <a href="#" class="profile" id="profile-btn">
                <i class="fas fa-user-circle"></i>
            </a>
        </nav>

        <main>
            <div class="head-title">
                <div class="left">
                    <h1>Teacher Dashboard</h1>
                    <ul class="breadcrumb">
                        <li>
                            <a href="">Dashboard</a>
                        </li>
                        <li><i class='bx bx-chevron-right'></i></li>
                        <li>
                            <a class="active" href="#">Home</a>
                        </li>
                    </ul>
                </div>
            </div>



            <div class="data">
                <div class="page">
                    <h1>Learning File List</h1>
                </div>
                
                <div class="subject-list" id="subjectList">
                    <p class="no-reviewers" style="color:gray;">Loading...</p>
                </div>
            </div>
            
                <div class="data" hidden>
                    <div class="page">
                        <h1>Learning Materials</h1>
                    </div>
                    <div class="subject-list" id="fileList">
                        <p class="no-reviewers" style="color:gray;">Loading...</p>
                    </div>
                </div>
            

            
        </main>
    </section>

    <!-- Notification Modal -->
    <div id="notif-modal" class="notif">
        <div class="notif-content">
            <div class="close-button">
            	<img src="img/back-button.png">
        	</div>
            <h2>Notifications</h2>
            
            <!-- Study Reminders Section -->
            <h3>Study Reminders</h3>
            <ul id="study-reminders">
                <!-- Study reminders will be dynamically added here -->
            </ul>

            <!-- Exam Updates Section -->
            <h3>Exam Updates</h3>
            <ul id="exam-updates">
                <!-- Exam updates will be dynamically added here -->
            </ul>
        </div>
    </div>
        
     <!-- Profile Modal -->
<div class="container" id="profile-popup">
    <div class="box form-box" id="popup">
        <div class="close-button">
            <img src="img/back-button.png">
        </div>
        <header>PROFILE</header>
        <div class="profile-info">
            <div class="field">
                <label for="userfullname">Full Name</label>
                <p id="userfullname">Loading...</p>
            </div>
            <div class="field">
                <label for="username">Username</label>
                <p id="username">Loading...</p>
            </div>
            <div class="field">
                <label for="useremail">Email</label>
                <p id="useremail">Loading...</p>
            </div>
            <div class="field">
                <label for="userphone">Phone Number</label>
                <p id="userphone">Loading...</p>
            </div>
        </div>
        <div class="field">
            <button class="fbtn" id="edit-profile-btn">Edit Profile</button>
        </div>
    </div>
</div>
        
<script>
document.addEventListener('DOMContentLoaded', function() {
    loadPDFs();
    
    const modal = document.getElementById('pdfModal');
    const modalTitle = document.getElementById('modalTitle');
    const pdfForm = document.getElementById('pdfForm');
    const closeModalBtn = document.querySelector('.close-modal');
    
    window.openModal = function(pdfId = null) {
        if (pdfId) {
            modalTitle.textContent = 'Edit PDF Link';
            fetchPDF(pdfId);
        } else {
            modalTitle.textContent = 'Add PDF Link';
            pdfForm.reset();
            pdfForm.dataset.mode = 'add';
            document.getElementById('linkUploadGroup').innerHTML = `
                <label for="pdf_link">PDF Link:</label>
                <input type="url" id="pdf_link" name="pdf_link" required
                       placeholder="https://docs.google.com/document/d/... or direct PDF URL">
                <p class="hint">For Google Docs, paste the shareable "edit" link</p>
            `;
        }
        modal.style.display = 'block';
    };
    
    closeModalBtn.onclick = function() {
        modal.style.display = 'none';
    };
    
    window.onclick = function(event) {
        if (event.target === modal) {
            modal.style.display = 'none';
        }
    };
    
    pdfForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const formData = new FormData(pdfForm);
        const submitBtn = pdfForm.querySelector('button[type="submit"]');
        submitBtn.disabled = true;
        
        const operation = pdfForm.dataset.mode === 'edit' ? 
            updatePDF(formData) : createPDF(formData);
        
        operation.finally(() => {
            submitBtn.disabled = false;
        });
    });
});

function loadPDFs() {
    fetch('pdf_crud.php')
        .then(response => response.json())
        .then(data => {
            const container = document.getElementById('subjectList');
            if (data.error) {
                container.innerHTML = `<p style="color:red;">${data.error}</p>`;
                return;
            }
            
            container.innerHTML = data.length ? data.map(pdf => `
                <div class="subject-button">
                    <div class="subject-name">
                        <i class="fas fa-file-pdf"></i>
                        <span>${pdf.pdf_name}</span>
                    </div>
                    <div class="actions">
                        
                    </div>
                </div>
            `).join('') : '<p>No PDF links found</p>';
        })
        .catch(error => {
            console.error('Error:', error);
            document.getElementById('subjectList').innerHTML = 
                '<p style="color:red;">Error loading PDF links</p>';
        });
}

function convertToExportLink(link) {
    if (!link) return { original: '', converted: '' };
    
    // For Google Docs edit links
    if (link.includes('docs.google.com') && link.includes('/edit')) {
        const match = link.match(/\/d\/([^\/]+)/);
        if (match && match[1]) {
            return {
                original: link,
                converted: `https://docs.google.com/document/d/${match[1]}/export?format=pdf`
            };
        }
    }
    
    // For all other links
    return {
        original: link,
        converted: link.endsWith('.pdf') ? link : link
    };
}

// Updated createPDF function
function createPDF(formData) {
    const linkConversion = convertToExportLink(formData.get('pdf_link'));
    
    const pdfData = {
        pdf_name: formData.get('pdf_name'),
        pdf_link: linkConversion.original, // Store original
        pdf_dl_path: linkConversion.converted // Store converted
    };
    
    return fetch('pdf_crud.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            pdf_name: pdfData.pdf_name,
            pdf_link: pdfData.pdf_link // Original link
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.error) throw new Error(data.error);
        alert('PDF link saved!');
        document.getElementById('pdfModal').style.display = 'none';
        loadPDFs();
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Error: ' + error.message);
    });
}

// Updated fetchPDF to show original link
function fetchPDF(pdfId) {
    return fetch(`pdf_crud.php?pdf_id=${pdfId}`)
        .then(response => response.json())
        .then(data => {
            document.getElementById('pdf_name').value = data.pdf_name;
            // Show original link (pdf_path) in edit mode
            document.getElementById('pdf_link').value = data.pdf_path; 
            pdfForm.dataset.mode = 'edit';
            pdfForm.dataset.pdfId = data.pdf_id;
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Error loading PDF details');
        });
}

function updatePDF(formData) {
    const pdfId = pdfForm.dataset.pdfId;
    const linkConversion = convertToExportLink(formData.get('pdf_link'));
    
    return fetch('pdf_crud.php', {
        method: 'PUT',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            pdf_id: pdfId,
            pdf_name: formData.get('pdf_name'),
            pdf_link: formData.get('pdf_link') // Original link
        })
    })
    .then(response => {
        // First check if response is JSON
        const contentType = response.headers.get('content-type');
        if (!contentType || !contentType.includes('application/json')) {
            return response.text().then(text => {
                throw new Error(text || 'Invalid server response');
            });
        }
        return response.json();
    })
    .then(data => {
        if (data.error) throw new Error(data.error);
        alert('PDF link updated successfully!');
        document.getElementById('pdfModal').style.display = 'none';
        loadPDFs();
        return data;
    })
    .catch(error => {
        console.error('Update error:', error);
        alert('Error updating PDF: ' + error.message);
        throw error;
    });
}

function deletePDF(pdfId) {
    if (!confirm('Delete this PDF link?')) return;
    
    fetch('pdf_crud.php', {
        method: 'DELETE',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ pdf_id: pdfId })
    })
    .then(response => response.json())
    .then(data => {
        if (data.error) throw new Error(data.error);
        alert('PDF link deleted!');
        loadPDFs();
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Error: ' + error.message);
    });
}
</script>

    <script src="notif.js"></script>
    <script src="fetch_profile.js"></script>
</body>
</html>